# ToonDB KV Put/Scan Benchmark Workload
# Tests basic key-value insert and scan operations

[workload]
name = "kv_put_scan"
description = "Measures ToonDB KV insert throughput and full-table scan performance"
runner = "rust"
binary = "perf-run"

[params]
# Number of records to insert
n = 100000
# Batch size for inserts (0 = single-record transactions)
batch_size = 1000
# Transaction mode: "single" (one big txn) or "batched" (multiple small txns)
txn_mode = "single"
# Value size template
value_template = "json_user"
# Whether to run scan after inserts
run_scan = true
# Number of warmup iterations
warmup_iterations = 1
# Number of timed iterations  
timed_iterations = 5

[metrics]
# Metrics to collect
collect = [
    "insert_throughput_ops_per_s",
    "scan_throughput_rows_per_s", 
    "insert_latency_ms_p50",
    "insert_latency_ms_p99",
    "scan_latency_ms_p50",
    "scan_latency_ms_p99",
    "peak_rss_mb",
    "total_duration_s"
]

[thresholds]
# Regression thresholds (as percentage)
insert_throughput_ops_per_s = { threshold = 5.0, better = "higher" }
scan_throughput_rows_per_s = { threshold = 5.0, better = "higher" }
insert_latency_ms_p50 = { threshold = 5.0, better = "lower" }
insert_latency_ms_p99 = { threshold = 10.0, better = "lower" }
scan_latency_ms_p50 = { threshold = 5.0, better = "lower" }
scan_latency_ms_p99 = { threshold = 10.0, better = "lower" }
peak_rss_mb = { threshold = 8.0, better = "lower" }
